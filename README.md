# üêÑ Familia Mercado App - Gesti√≥n Ganadera

Una aplicaci√≥n web progresiva (PWA) para la gesti√≥n integral de ganado, dise√±ada espec√≠ficamente para la empresa familiar Guti√©rrez Hnos de San Mart√≠n, Chaco, Argentina.

## üéØ Objetivo

Reemplazar el manejo emp√≠rico y en papel por un sistema moderno, simple, robusto y adaptable, dise√±ado para uso f√°cil desde el campo en PC, m√≥vil y tablet.

## üöÄ Instalaci√≥n y Configuraci√≥n

### Requisitos Previos
- Node.js 18+ 
- npm o yarn
- Cuenta de Supabase

### Instalaci√≥n

1. **Clonar el repositorio**
   ```bash
   git clone https://github.com/ulicseg/Gutierrez-Hnos-App.git
   cd Gutierrez-Hnos-App
   ```

2. **Instalar dependencias**
   ```bash
   npm install
   ```

3. **Configurar variables de entorno**
   ```bash
   cp .env.example .env
   ```
   
   Editar `.env` con tus credenciales de Supabase:
   ```bash
   VITE_SUPABASE_URL=https://tu-proyecto.supabase.co
   VITE_SUPABASE_ANON_KEY=tu-clave-anonima
   ```

4. **Configurar base de datos (Supabase)**
  
  Ejecuta los scripts en el panel SQL de tu proyecto Supabase, en este orden:
  ```sql
  -- 1) Creaci√≥n de tablas, funciones, triggers, RLS y pol√≠ticas
  \i database/create_all_tables.sql

  -- 2) Datos de ejemplo (opcional)
  \i database/insert_sample_data.sql
  ```
  Notas:
  - El script `create_all_tables.sql` crea todo el esquema (tablas, √≠ndices), funciones (`is_admin()`, `set_created_by()`, `set_updated_at()`), triggers, activa RLS y define pol√≠ticas por tabla.
  - El script `insert_sample_data.sql` carga usuarios, proveedores, compradores, animales, compras/ventas, facturas y notificaciones de ejemplo.

### Comandos de Desarrollo

```bash
# Servidor de desarrollo
npm run dev

# Build para producci√≥n
npm run build

# Preview del build
npm run preview

# Linting
npm run lint
```

### Deploy

```bash
# Build optimizado
npm run build

# Los archivos listos para deploy estar√°n en /dist
```

## üõ† Tecnolog√≠as

- **Frontend**: React 18 + TypeScript + Vite
- **Estilos**: TailwindCSS
- **Navegaci√≥n**: React Router DOM
- **Animaciones**: Framer Motion
- **Iconograf√≠a**: Lucide React
- **Estado**: Zustand
- **Backend**: Supabase (PostgreSQL + Auth + Storage + Realtime)
- **PWA**: Service Worker custom + Manifest (instalable/offline/push)
- **Build**: Vite + TypeScript

## üé® Dise√±o Rural

### Paleta de Colores
- **Fondo**: `#F5F2E7` (beige claro, "papel rural")
- **Textos/t√≠tulos**: `#3C454A` (azul oscuro/gris piedra)
- **Primario/acentos**: `#67806D` (verde oliva/campo)
- **Secundario**: `#805A36` (marr√≥n oscuro)
- **Fondo alterno**: `#F9E9D0` (beige c√°lido)
- **Alertas**: `#F8B36A` (naranja suave)
- **Tarjetas**: Blanco puro

### Caracter√≠sticas de Dise√±o
- Tipograf√≠a sans-serif moderna (Inter, Poppins, Nunito)
- Bordes redondeados y espacios amplios
- Animaciones suaves con Framer Motion
- Design mobile-first y responsive
- Iconograf√≠a rural clara

## üìä Modelo de Datos

### Tablas Principales (Supabase/PostgreSQL)

- **proveedores**: Datos de proveedores de ganado
- **compradores**: Informaci√≥n de compradores
- **transportadores**: Datos de transportistas
- **compras**: Registro de compras de ganado
- **animales**: Stock de animales con historial
- **ventas**: Registro de ventas
- **detalle_venta**: Detalle de animales vendidos
- **eventos_sanitarios**: Historial sanitario
- **usuarios**: Gesti√≥n de usuarios y roles
- **facturas**: Facturaci√≥n (A/B/C/E) vinculada a compras/ventas
- **configuraciones** y **configuracion_facturacion**

### Relaciones Clave
- Compras ‚Üí Animales (1:N)
- Ventas ‚Üí Detalle_venta ‚Üí Animales (1:N:1)
- Animales ‚Üí Eventos_sanitarios (1:N)
- Usuarios con roles (administrador/operador)

## üîê Sistema de Autenticaci√≥n

- **Login empresarial**: Solo usuarios autorizados
- **Creaci√≥n de usuarios**: Solo administradores
- **Roles y permisos**: Administrador y Operador
- **Sesiones persistentes**: Mantiene login entre recargas
- **Protecci√≥n de rutas**: Acceso controlado por autenticaci√≥n

## üì± Funcionalidades Principales

### ‚úÖ Completadas (Fase 1 y 2)
- **Layout Responsive**: Navegaci√≥n lateral (desktop) y inferior (m√≥vil)
- **Sistema de Autenticaci√≥n**: Login, protecci√≥n de rutas, gesti√≥n de usuarios
- **Tema Rural**: Dise√±o completo con paleta de colores y animaciones

### ‚úÖ Facturaci√≥n
- Generaci√≥n de facturas desde Compras/Ventas
- Numeraci√≥n autom√°tica por tipo (A/B/C/E) con `configuracion_facturacion`
- PDF (descarga y previsualizaci√≥n en modal)
- Uso de datos de empresa desde Configuraci√≥n

### ‚úÖ PWA (Progresive Web App)
- Instalaci√≥n como app nativa (Banner de instalaci√≥n)
- Funcionamiento Offline (Service Worker: cache first/network first/stale-while-revalidate)
- Notificaciones push (permiso y env√≠o desde UI)
- Estado de conexi√≥n y sincronizaci√≥n en segundo plano

## üõ†Ô∏è Instalaci√≥n y Desarrollo

```bash
# Clonar repositorio
git clone https://github.com/ulicseg/Gutierrez-Hnos-App.git
cd gutierrez-hnos-app

# Instalar dependencias
npm install

# Configurar variables de entorno
cp .env.example .env
# Agregar credenciales de Supabase

# Ejecutar en desarrollo
npm run dev

# Construir para producci√≥n
npm run build
```

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ assets/          # Logo e im√°genes
‚îú‚îÄ‚îÄ components/      # Componentes reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ Layout.jsx   # Layout principal con navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ Header.jsx   # Header con notificaciones
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.jsx  # Navegaci√≥n lateral
‚îÇ   ‚îú‚îÄ‚îÄ BottomNav.jsx # Navegaci√≥n m√≥vil
‚îÇ   ‚îî‚îÄ‚îÄ ConfirmModal.jsx # Modal de confirmaci√≥n personalizado
‚îú‚îÄ‚îÄ pages/           # P√°ginas principales
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx    # Panel principal con KPIs
‚îÇ   ‚îú‚îÄ‚îÄ Animales.jsx     # Gesti√≥n de animales
‚îÇ   ‚îú‚îÄ‚îÄ Compras.jsx      # Registro de compras
‚îÇ   ‚îú‚îÄ‚îÄ Ventas.jsx       # Gesti√≥n de ventas
‚îÇ   ‚îú‚îÄ‚îÄ Sanidad.jsx      # Eventos sanitarios
‚îÇ   ‚îú‚îÄ‚îÄ Proveedores.jsx  # Gesti√≥n de proveedores
‚îÇ   ‚îú‚îÄ‚îÄ Transportadores.jsx # Gesti√≥n de transportadores
‚îÇ   ‚îú‚îÄ‚îÄ Usuarios.jsx     # Administraci√≥n de usuarios
‚îÇ   ‚îú‚îÄ‚îÄ Configuracion.jsx # Configuraci√≥n y mantenimiento
‚îÇ   ‚îî‚îÄ‚îÄ Ayuda.jsx        # Ayuda y soporte
‚îú‚îÄ‚îÄ routes/          # Configuraci√≥n de rutas
‚îú‚îÄ‚îÄ store/           # Estado global (Zustand)
‚îú‚îÄ‚îÄ utils/           # Utilidades y Supabase client
‚îî‚îÄ‚îÄ hooks/           # Custom hooks (useConfirm, useNotifications)
```

## üóÑÔ∏è Base de datos: Seguridad y Pol√≠ticas (RLS)

- RLS activado en todas las tablas
- Funciones:
  - `is_admin()` (SECURITY DEFINER) para pol√≠ticas
  - `set_created_by()` y `set_updated_at()` via triggers
- Pol√≠ticas por tabla (SELECT/INSERT/UPDATE/DELETE):
  - Lectura: usuarios autenticados
  - Escritura: due√±o del registro (`created_by = auth.uid()`) o administrador
  - Tablas maestras (proveedores/compradores/transportadores/configuraciones): escritura solo admin
  - Detalles (detalle_compra/venta): permiso por pertenencia a la cabecera

> Todo lo anterior est√° incluido y documentado en `database/create_all_tables.sql`.

## üîÑ Progreso del Desarrollo

### ‚úÖ Fase 1: Layout y Navegaci√≥n
- Layout responsivo completo (sidebar/bottom navigation)
- Navegaci√≥n funcional entre p√°ginas
- Tema rural implementado

### ‚úÖ Fase 2: Autenticaci√≥n
- Sistema de login empresarial
- Protecci√≥n de rutas
- Gesti√≥n de roles (Admin/Operador)

### ‚úÖ Fase 3: Dashboard
- KPIs principales implementados
- Informaci√≥n del establecimiento
- Estad√≠sticas visuales

### ‚úÖ Fase 4: Gesti√≥n de Animales
- Stock de animales con filtros
- Historial de compras y ventas
- Estados de animal (disponible/vendido)

### ‚úÖ Fase 5: Compras
- Wizard de compra guiado
- Carga individual y por lotes
- Integraci√≥n con proveedores

### ‚úÖ Fase 6: Ventas
- Selecci√≥n de animales disponibles
- Tipos de venta (directa/feria)
- Integraci√≥n con compradores

### ‚úÖ Fase 7: Sanidad
- Registro de eventos sanitarios
- Medicamentos y tratamientos
- Historial por animal

### ‚úÖ Fase 8: Gesti√≥n de Usuarios
- Creaci√≥n de usuarios (solo admin)
- Asignaci√≥n de roles
- Estado activo/inactivo
- **Eliminaci√≥n completa**: Auth + Base de datos via endpoint serverless
- **Acceso restringido**: Solo administradores pueden ver/acceder
- **Protecci√≥n de rutas**: AdminRoute para usuarios
- **UI condicional**: Sidebar oculta "Usuarios" para operadores

### ‚úÖ Fase 9: Configuraci√≥n
- Gesti√≥n de proveedores/transportadores
- Mantenimiento de base de datos (solo admin)
- Configuraciones del sistema

### ‚úÖ Fase 10: Confirmaciones Personalizadas
- Modal de confirmaci√≥n branded
- Reemplazo de window.confirm
- Funciones helper (confirmDelete, confirmAction)

### ‚úÖ API Serverless (Vercel Functions)
- **POST /api/deleteUser**: Eliminaci√≥n completa de usuarios
- Integraci√≥n con Supabase Auth Admin API
- Variables de entorno seguras

### ‚úÖ Fase A: Optimizaci√≥n para Producci√≥n
- Variables de entorno configuradas
- Build optimizado con chunks separados
- Limpieza de archivos temporales
- Configuraci√≥n PWA
- README actualizado
- Sistema de notificaciones en tiempo real
- Seguridad mejorada

## üöÄ Deploy y Producci√≥n

### Variables de Entorno Requeridas
```env
# Desarrollo local (.env.local):
VITE_SUPABASE_URL=tu_url_supabase
VITE_SUPABASE_ANON_KEY=tu_clave_anonima

# Producci√≥n (configurar en plataforma de deploy):
VITE_SUPABASE_URL=tu_url_supabase
VITE_SUPABASE_ANON_KEY=tu_clave_anonima
```

### Preparaci√≥n para Deploy
```bash
# 1. Configurar variables de entorno
cp .env.example .env.local
# Completar con credenciales reales

# 2. Instalar dependencias
npm install

# 3. Construir para producci√≥n
npm run build

# 4. Verificar build (opcional)
npm run preview
```

### ‚ö†Ô∏è Seguridad de Variables de Entorno
- ‚úÖ Usa `.env.local` para desarrollo (excluido del repo)
- ‚úÖ Configura variables en la plataforma de deploy para producci√≥n
- ‚úÖ Las claves ANON de Supabase son p√∫blicas por dise√±o
- ‚ùå NUNCA expongas la `service_role` key en el frontend
- üìñ Lee `ENV_SETUP.md` para instrucciones detalladas

### Plataformas de Deploy Recomendadas
- **Vercel**: Deploy autom√°tico desde GitHub
- **Netlify**: Configuraci√≥n zero-config
- **GitHub Pages**: Para proyectos p√∫blicos
- **Railway**: Con backend incluido

### Configuraci√≥n de Build Optimizada
El proyecto est√° configurado con:
- **Chunks separados**: vendor, router, supabase, ui, utils
- **Tree shaking**: Eliminaci√≥n de c√≥digo no usado
- **Compresi√≥n**: Gzip habilitado
- **PWA**: Service worker para cache
- **TypeScript**: Verificaci√≥n de tipos en build

### Tama√±o de Build Optimizado
```
dist/assets/
‚îú‚îÄ‚îÄ vendor-[hash].js     (12.35 kB)   # React, ReactDOM
‚îú‚îÄ‚îÄ router-[hash].js     (32.14 kB)   # React Router
‚îú‚îÄ‚îÄ supabase-[hash].js   (117.03 kB)  # Supabase client
‚îú‚îÄ‚îÄ ui-[hash].js         (150.76 kB)  # Framer Motion, Lucide
‚îú‚îÄ‚îÄ utils-[hash].js      (4.12 kB)    # Utilidades
‚îî‚îÄ‚îÄ index-[hash].js      (936 kB)     # C√≥digo de la app
```

**Total optimizado**: ~1.27 MB (vs 2.1 MB sin optimizaci√≥n)
- [x] Configuraci√≥n inicial del proyecto
- [x] Implementaci√≥n de TailwindCSS
- [x] Layout responsive completo
- [x] Navegaci√≥n lateral y m√≥vil
- [x] Tema rural y animaciones

### ‚úÖ Fase 2: Autenticaci√≥n
- [x] Configuraci√≥n de Supabase Auth
- [x] Store de autenticaci√≥n con Zustand
- [x] P√°ginas de login
- [x] Protecci√≥n de rutas
- [x] Gesti√≥n de usuarios (solo admin)

### üîÑ Fase 3: Dashboard y KPIs (Pr√≥ximo)
- [ ] M√©tricas principales
- [ ] Gr√°ficos y visualizaciones
- [ ] Alertas y notificaciones

### üîÑ Fase 4: Gesti√≥n de Animales
- [ ] Listado con filtros avanzados
- [ ] Ficha individual de animal
- [ ] Historial sanitario
- [ ] Exportaci√≥n de datos

## ü§ù Contribuci√≥n

Este es un proyecto espec√≠fico para Familia Mercado. Para contribuir:

1. Fork del repositorio
2. Crear rama de feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit de cambios (`git commit -m 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üìÑ Licencia

Proyecto privado para uso exclusivo de Familia Mercado.

---

**Desarrollado con ‚ù§Ô∏è para la gesti√≥n ganadera moderna** üåæ
